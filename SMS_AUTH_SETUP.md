# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É SMS –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ SMS –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤–º–µ—Å—Ç–æ API —Ç–æ–∫–µ–Ω–æ–≤:

1. **[services/wb_browser.py](services/wb_browser.py)** - –ë—Ä–∞—É–∑–µ—Ä–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Playwright
2. **[database.py](database.py)** - –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `browser_sessions` (—Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞)
3. **[handlers/browser_auth.py](handlers/browser_auth.py)** - –•—ç–Ω–¥–ª–µ—Ä —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ `/auth`, `/sessions`, `/logout`
4. **[bot.py](bot.py)** - –û–±–Ω–æ–≤–ª–µ–Ω: `/start` —Ç–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫–∞–µ—Ç SMS –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

## üìã –ù–æ–≤—ã–π —Ñ–ª–æ—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start
     ‚Üì
–ë–æ—Ç: "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
     ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí +79991234567
     ‚Üì
–ë–æ—Ç: –ó–∞–ø—É—Å–∫–∞–µ—Ç Playwright ‚Üí seller.wildberries.ru ‚Üí –í–≤–æ–¥–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω
WB –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SMS –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     ‚Üì
–ë–æ—Ç: "–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS"
     ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí 123456
     ‚Üì
–ë–æ—Ç: –í–≤–æ–¥–∏—Ç –∫–æ–¥ ‚Üí –ü–æ–ª—É—á–∞–µ—Ç cookies ‚Üí –®–∏—Ñ—Ä—É–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
     ‚Üì
–ë–æ—Ç: "‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ú–∞–≥–∞–∑–∏–Ω: iphasnulin" + –∫–Ω–æ–ø–∫–∞ Mini App
```

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Playwright

```bash
cd /Users/producer/Documents/Projects/wbpereraspr
pip install playwright
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä Chromium

```bash
playwright install chromium
```

**–í–∞–∂–Ω–æ**: –≠—Ç–æ —Å–∫–∞—á–∞–µ—Ç ~300MB —Ñ–∞–π–ª–æ–≤, —Ç–∞–∫ —á—Ç–æ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –º–µ—Å—Ç–æ.

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É

```bash
python -c "from playwright.sync_api import sync_playwright; print('Playwright OK')"
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: `Playwright OK`

## üß™ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ .env –Ω–∞—Å—Ç—Ä–æ–µ–Ω

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ `.env` –µ—Å—Ç—å:

```env
BOT_TOKEN=your_bot_token
WB_ENCRYPTION_KEY=your_32_char_key
WEBAPP_URL=https://your-app.railway.app
DATABASE_PATH=bot_data.db
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
python bot.py
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–ª–æ—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram ‚Üí –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–ø—Ä–æ—Å–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: `+79991234567` (–≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ WB)
5. –ë–æ—Ç –æ—Ç–∫—Ä–æ–µ—Ç –±—Ä–∞—É–∑–µ—Ä (headless) –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç SMS
6. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS
7. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å: "‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!" + –∫–Ω–æ–ø–∫–∞ Mini App

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è WB —Å–∞–π—Ç–∞

–í —Ñ–∞–π–ª–µ [services/wb_browser.py](services/wb_browser.py) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–ø—Ä–∏–º–µ—Ä–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã**.

–ù—É–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Å–∞–π—Ç seller.wildberries.ru –∏ –Ω–∞–π—Ç–∏ —Ç–æ—á–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã:

### –ì–¥–µ –Ω–∞–π—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã:

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://seller.wildberries.ru/ –≤ Chrome
2. –ù–∞–∂–º–∏—Ç–µ F12 (DevTools)
3. –ù–∞–∂–º–∏—Ç–µ Ctrl+Shift+C (–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
4. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
5. –í DevTools –ø–æ—è–≤–∏—Ç—Å—è HTML –∫–æ–¥ —ç–ª–µ–º–µ–Ω—Ç–∞

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å:

**–ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞** (—Å—Ç—Ä–æ–∫–∞ 157 –≤ wb_browser.py):
```python
phone_input = await self.page.wait_for_selector(
    'input[type="tel"], input[name="phone"], input[placeholder*="—Ç–µ–ª–µ—Ñ–æ–Ω"]',
    timeout=10000
)
```

**–ö–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥"** (—Å—Ç—Ä–æ–∫–∞ 167):
```python
submit_button = await self.page.wait_for_selector(
    'button[type="submit"], button:has-text("–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥"), button:has-text("–í–æ–π—Ç–∏")',
    timeout=5000
)
```

**–ü–æ–ª–µ –≤–≤–æ–¥–∞ SMS –∫–æ–¥–∞** (—Å—Ç—Ä–æ–∫–∞ 178):
```python
sms_input = await self.page.wait_for_selector(
    'input[type="text"][maxlength="6"], input[name="code"], input[placeholder*="–∫–æ–¥"]',
    timeout=10000
)
```

### –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã:

1. –ù–∞–π–¥–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ —Å–∞–π—Ç–µ WB
2. –û—Ç–∫—Ä–æ–π—Ç–µ [services/wb_browser.py](services/wb_browser.py)
3. –ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ 157, 167, 178, 212 –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Railway

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Playwright –Ω–∞ Railway

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ —Ñ–∞–π–ª `Aptfile` (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç):

```
chromium
chromium-driver
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç chromium –Ω–∞ Railway —Å–µ—Ä–≤–µ—Ä–µ.

### 2. –û–±–Ω–æ–≤–∏—Ç–µ Procfile (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```
web: uvicorn api.main:app --host 0.0.0.0 --port $PORT
worker: python bot.py
```

### 3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í Railway Dashboard ‚Üí Variables:

```
WEBAPP_URL=https://your-app.railway.app
BOT_TOKEN=...
WB_ENCRYPTION_KEY=...
DATABASE_URL=... (PostgreSQL URL –æ—Ç Railway)
```

### 4. Push –∏ –¥–µ–ø–ª–æ–π

```bash
git add .
git commit -m "Add SMS authentication with Playwright"
git push origin main
```

Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è.

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

Railway Dashboard ‚Üí Deployments ‚Üí View Logs

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
INFO - Browser started successfully
INFO - Requesting SMS code for phone: +79991234567
INFO - SMS code input appeared - SMS sent successfully
```

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Playwright –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ Railway

**–°–∏–º–ø—Ç–æ–º**: `ModuleNotFoundError: No module named 'playwright'`

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –í Railway Dashboard ‚Üí Settings ‚Üí Build Command:
pip install -r requirements.txt && playwright install chromium --with-deps
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Chromium –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (headless)

**–°–∏–º–ø—Ç–æ–º**: `Browser closed unexpectedly`

**–†–µ—à–µ–Ω–∏–µ**: –í [services/wb_browser.py:71](services/wb_browser.py#L71) –¥–æ–±–∞–≤–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã:
```python
self.browser = await self._playwright.chromium.launch(
    headless=True,
    args=[
        '--disable-blink-features=AutomationControlled',
        '--disable-dev-shm-usage',
        '--no-sandbox',
        '--disable-setuid-sandbox'  # –î–æ–±–∞–≤–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É
    ]
)
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –°–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

**–°–∏–º–ø—Ç–æ–º**: `TimeoutError: waiting for selector`

**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–º. —Ä–∞–∑–¥–µ–ª –≤—ã—à–µ "–í–∞–∂–Ω–æ: –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è WB —Å–∞–π—Ç–∞")

### –ü—Ä–æ–±–ª–µ–º–∞ 4: SMS –∫–æ–¥ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º**: WB –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SMS

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
- –ù–æ–º–µ—Ä –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ –ø—Ä–æ–¥–∞–≤–µ—Ü –Ω–∞ WB
- WB –¥–µ—Ç–µ–∫—Ç–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é (–Ω—É–∂–µ–Ω `user-agent`, `viewport`)
- IP –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω WB (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å –¥—Ä—É–≥–æ–≥–æ IP)

## üìù –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã + SMS –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| `/auth` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ SMS (–µ—Å–ª–∏ —É–∂–µ –±—ã–ª /start) |
| `/sessions` | –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π |
| `/logout` | –í—ã–π—Ç–∏ –∏–∑ —Å–µ—Å—Å–∏–∏ |
| `/balance` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ |

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è SMS –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

1. **–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥** - handlers/token_management.py (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
2. **–û–±–Ω–æ–≤–∏—Ç—å Mini App** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å browser_sessions –≤–º–µ—Å—Ç–æ —Ç–æ–∫–µ–Ω–æ–≤
3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–æ–∫** - –º–µ—Ç–æ–¥ `create_supply()` –≤ wb_browser.py
4. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤** - —á–µ—Ä–µ–∑ browser scraping (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
5. **–î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ–ø–ª–∞—Ç—ã** - –ÆKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Playwright –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
